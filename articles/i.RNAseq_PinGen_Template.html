<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>halfBaked RNA-seq Pin Generation Template • halfBaked</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="halfBaked RNA-seq Pin Generation Template">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">halfBaked</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/halfBaked.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/i.RNAseq_PinGen_Template.html">halfBaked RNA-seq Pin Generation Template</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/j-andrews7/halfBaked/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>halfBaked RNA-seq Pin Generation Template</h1>
                        <h4 data-toc-skip class="author">Jared
Andrews</h4>
            <address class="author_afil">
      St. Jude Children’s Research
Hospital<br><a class="author_email" href="mailto:#"></a><a href="mailto:jared.andrews07@gmail.com" class="email">jared.andrews07@gmail.com</a>
      </address>
                  
            <h4 data-toc-skip class="date">2025-03-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/j-andrews7/halfBaked/blob/devel/vignettes/i.RNAseq_PinGen_Template.Rmd" class="external-link"><code>vignettes/i.RNAseq_PinGen_Template.Rmd</code></a></small>
      <div class="d-none name"><code>i.RNAseq_PinGen_Template.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="study---experiment---rna-seq-data---pin-generation">Study - Experiment - RNA-seq Data - Pin Generation<a class="anchor" aria-label="anchor" href="#study---experiment---rna-seq-data---pin-generation"></a>
</h2>
<p>This notebook details how to create re-usable and easily shared <a href="https://pins.rstudio.com/articles/pins.html" class="external-link">pins</a> for RNA-seq
data. These pins will contain a <code>SummarizedExperiment</code> object
containing gene counts, normalized counts, transformed counts, and TPMs
along with sample metadata. In short, pretty much everything one would
need to perform downstream analyses.</p>
<p>For convenience, we’ll also store experiment/dataset description, the
code used to generate the pin (i.e. this notebook).</p>
<p>It’s recommended to detail how gene counts were generated here.</p>
<p>We typically use the <a href="https://nf-co.re/rnaseq/" class="external-link">nf-core
RNA-seq pipeline</a> to generate BAMs and salmon quantifications, which
are then used to generate gene counts appropriate for downstream use.
This is convenient as the samplesheets can double as our sample metadata
tables here.</p>
<p>Noting the pipeline version, genome information, and any altered
parameters here is recommended.</p>
<p>As an example, this notebook details pin generation for data from <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE135880" class="external-link">GSE135880</a>,
which was processed with the nf-core RNA-seq pipeline:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">nextflow</span> run nf-core/rnaseq <span class="at">-r</span> 3.12.0 <span class="at">-profile</span> singularity <span class="at">-c</span> <span class="st">"</span><span class="va">$BAKER_REF</span><span class="st">"</span>/nf_configs/rnaseq.config <span class="at">-w</span> /scratch_space/jandrews/<span class="st">"</span><span class="va">$LSB_JOBNAME</span><span class="st">"</span> <span class="dt">\</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>--outdir ./nfcore_mm10 <span class="at">--email</span> jared.andrews@stjude.org <span class="at">--input</span> nfcore_rnaseq.samplesheet.csv <span class="at">--gencode</span> <span class="at">--genome</span> MM10 <span class="at">--aligner</span> star_salmon <span class="dt">\</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>--pseudo_aligner salmon <span class="at">--max_memory</span> 128.GB <span class="at">--skip_stringtie</span> <span class="at">--max_multiqc_email_size</span> 15.MB <span class="at">-resume</span></span></code></pre></div>
<div class="section level3">
<h3 id="params-usage">Params Usage<a class="anchor" aria-label="anchor" href="#params-usage"></a>
</h3>
<p>This notebook uses YAML <a href="https://bookdown.org/yihui/rmarkdown/parameterized-reports.html" class="external-link">params</a>
in the header to specify the pin name and board to upload the pin to.
This allows for easy re-use of the notebook for different datasets and
boards in a lazy fashion.</p>
<p>Read more about the <a href="https://pins.rstudio.com/articles/pins.html" class="external-link">pins</a> package if
you don’t know what a “board” is or how to use them.</p>
</div>
</div>
<div class="section level2">
<h2 id="experiment-info">Experiment Info<a class="anchor" aria-label="anchor" href="#experiment-info"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">description</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  **Study - SubStudy - Experiment - RNA-seq Data**</span></span>
<span><span class="st"></span></span>
<span><span class="st">  This dataset contains O4+ immunopanned oligodendrocyte precursor cells (OPCs) from cortices of P5 or P6 Eed KO or control mice.</span></span>
<span><span class="st">  See the [associated publication](https://www.science.org/doi/10.1126/sciadv.aaz6477) for more details.</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Please see the Pin generation code to view how this data was processed.</span></span>
<span><span class="st">  "</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-data-create-summarizedexperiment">Load Data &amp; Create SummarizedExperiment<a class="anchor" aria-label="anchor" href="#load-data-create-summarizedexperiment"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/SummarizedExperiment" class="external-link">SummarizedExperiment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pins.rstudio.com/" class="external-link">pins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load sample metadata.</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"nfcore_rnaseq.samplesheet.csv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop FASTQ file locations.</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">meta</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fastq_1"</span>, <span class="st">"fastq_2"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Load counts. This object was generated using tximport via the nf-core RNA-seq pipeline on the salmon quants and</span></span>
<span><span class="co"># is appropriate for pretty much all downstream DE packages (DESeq2, edgeR, limma).</span></span>
<span><span class="va">cts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="st">"salmon.merged.gene_counts_length_scaled.tsv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># nf-core RNA-seq pipeline generates a counts table with the first two columns as gene IDs and gene symbols.</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="va">cts</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cts</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">cts</span> <span class="op">&lt;-</span> <span class="va">cts</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Also carry along TPMs as an additional assay.</span></span>
<span><span class="va">tpms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="st">"salmon.merged.gene_tpm.tsv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">tpms</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tpms</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">tpms</span> <span class="op">&lt;-</span> <span class="va">tpms</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Set metadata rownames and ensure they match count column names.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">meta</span><span class="op">$</span><span class="va">sample</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cts</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a SummarizedExperiment object.</span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">SummarizedExperiment</a></span><span class="op">(</span></span>
<span>    assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">cts</span><span class="op">)</span>,</span>
<span>                  tpm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">tpms</span><span class="op">)</span>,</span>
<span>                  log2tpm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">tpms</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    colData <span class="op">=</span> <span class="va">meta</span>,</span>
<span>    rowData <span class="op">=</span> <span class="va">genes</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="add-metadata-to-summarized-experiment-and-upload-pin">Add Metadata to Summarized Experiment and Upload Pin<a class="anchor" aria-label="anchor" href="#add-metadata-to-summarized-experiment-and-upload-pin"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Render this notebook and add it to the metadata of the pin along with experiment metadata.</span></span>
<span><span class="va">pin_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">read_file</a></span><span class="op">(</span><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="st">"0.RNAseq_PinGen_Template.Rmd"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Annotated-class.html" class="external-link">metadata</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pin_code <span class="op">=</span> <span class="va">pin_code</span>, description <span class="op">=</span> <span class="va">description</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the object locally as well.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">se</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">pin_name</span>, <span class="st">".rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Here you would connect to your board and write the pin to it.</span></span>
<span><span class="va">board</span> <span class="op">&lt;-</span> <span class="fu">board_connect</span><span class="op">(</span>server <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">board</span><span class="op">)</span></span>
<span><span class="fu">pin_write</span><span class="op">(</span><span class="va">board</span>, <span class="va">se</span>, type <span class="op">=</span> <span class="st">"rds"</span>, name <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">pin_name</span>, title <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">pin_name</span>, description <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">pin_description</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.3 (2025-02-28)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 24.04.2 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] BiocStyle_2.34.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] digest_0.6.37       desc_1.4.3          R6_2.6.1           </span></span>
<span><span class="co">##  [4] bookdown_0.42       fastmap_1.2.0       xfun_0.51          </span></span>
<span><span class="co">##  [7] cachem_1.1.0        knitr_1.50          htmltools_0.5.8.1  </span></span>
<span><span class="co">## [10] rmarkdown_2.29      lifecycle_1.0.4     cli_3.6.4          </span></span>
<span><span class="co">## [13] pkgdown_2.1.1       sass_0.4.9          textshaping_1.0.0  </span></span>
<span><span class="co">## [16] jquerylib_0.1.4     systemfonts_1.2.1   compiler_4.4.3     </span></span>
<span><span class="co">## [19] tools_4.4.3         ragg_1.3.3          evaluate_1.0.3     </span></span>
<span><span class="co">## [22] bslib_0.9.0         yaml_2.3.10         BiocManager_1.30.25</span></span>
<span><span class="co">## [25] jsonlite_2.0.0      rlang_1.1.5         fs_1.6.5</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jared Andrews.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
